var SharedFolderAccessDialog=function(e){ContainerSelectionDialog.call(this,e),this.member=null,this.selectedAids=null,this.leftHeader=null,this.leftHeaderText=null,this.rightHeader=null,this.rightHeaderText=null};SharedFolderAccessDialog.prototype=Object.create(ContainerSelectionDialog.prototype),SharedFolderAccessDialog.prototype.constructor=SharedFolderAccessDialog,function(){SharedFolderAccessDialog.prototype.initialize=function(e){var t;ContainerSelectionDialog.prototype.initialize.apply(this,arguments),this.leftHeader=e.find(".identityLeft .header"),this.leftHeaderText=this.leftHeader.text(),this.leftPlaceHolder=e.find(".availableSearch"),this.leftPlaceHolderText=this.leftPlaceHolder.attr("placeholder"),this.rightHeader=e.find(".identityRight .header"),this.rightHeaderText=this.rightHeader.text(),this.rightPlaceHolder=e.find(".selectedSearch"),this.rightPlaceHolderText=this.rightPlaceHolder.attr("placeholder"),this.otherMembersElement=$("#sharedFolderAccessOtherUsers"),(t=this).inputFields.hidebydefault.onChange(function(e){e?(t.leftHeader.text(t.rightHeaderText),t.leftPlaceHolder.attr("placeholder",t.rightPlaceHolderText),t.rightHeader.text(t.leftHeaderText),t.rightPlaceHolder.attr("placeholder",t.leftPlaceHolderText)):(t.leftHeader.text(t.leftHeaderText),t.leftPlaceHolder.attr("placeholder",t.leftPlaceHolderText),t.rightHeader.text(t.rightHeaderText),t.rightPlaceHolder.attr("placeholder",t.rightPlaceHolderText))}),t.inputFields.applyToOthers.onChange(function(e){e?t.otherMembersElement.show():t.otherMembersElement.hide()})},SharedFolderAccessDialog.prototype.setup=function(){ContainerSelectionDialog.prototype.setup.apply(this,arguments);for(var e=[],t=dialogs.sharedFolder.getDialog().containers.existingMembers.getItemChildren(),r=0,i=t.length;r<i;++r){var s=t[r];s!==this.member&&e.push(new SharedFolderAccessCheckbox(s))}e.length>0&&(this.containers.otherMembers=new Container(e,{allowDrag:!1,searchInput:"sharedFolderAccessOtherUsersSearch",publishSelect:!1}),this.containers.otherMembers.initialize(document.getElementById("sharedFolderAccessOtherUsersContainer")))};SharedFolderAccessDialog.prototype.open=function(t,r){if(void 0===r){var i={shareid:t.getShareID()};return t instanceof SharedFolderUser?i.uid=t.getID():i.cgid=t.getID(),void LPRequest.makeDataRequest(LPProxy.getSharedFolderRestrictions,{params:i,success:this.createDynamicHandler(function(e){this.open(t,e)})})}var s=r.aids;if(this.member=t,this.selectedAids=function(e){for(var t={},r=0,i=e.length;r<i;++r)t[e[r]]=!0;return t}(s),!this.member._sharedGroup.isDownloaded())return m=this.member._sharedGroup,void dialogs.confirmation.open({title:Strings.translateString("Error"),text:Strings.translateString("Folder must be downloaded in order to edit a member's access. Would you like to download now?"),handler:function(){m._sharedFolderItem.startDownloading(),Dialog.prototype.closeAllDialogs()}});this.restrictedItems=[],this.unrestrictedItems=[];for(var a=[],o=[],l=[],d=r.restrictedItems.concat(r.unrestrictedItems),n=0,h=d.length;n<h;++n){var c=d[n],p=e(c,this.member._sharedGroup);a.push(p);var g=p instanceof Note?new NoteDisplay(p):new AccountDisplay(p);-1!==r.restrictedItems.indexOf(c)?l.push(g):o.push(g)}if(this.restrictedItems.push(new GroupDisplay(this.member._sharedGroup,l)),this.unrestrictedItems.push(new GroupDisplay(this.member._sharedGroup,o)),LPProxy.assignItemsToGroups(this.restrictedItems),LPProxy.assignItemsToGroups(this.unrestrictedItems),this.availableAids={},0!==a.length){for(n=0,h=a.length;n<h;++n){var u=a[n].getID();void 0===this.selectedAids[u]&&(this.availableAids[u]=!0)}var m;ContainerSelectionDialog.prototype.open.apply(this,[{title:"Edit Access: "+t.toString(),defaultData:{hidebydefault:"1"===r.hidebydefault}}])}else dialogs.alert.open({title:Strings.translateString("Edit Access"),text:Strings.translateString("Please add items to this folder before editing a member's access.")})};var e=function(e,t){e.aid=e.id,e.group=e.group||"";var r="http://sn"===e.url?new Note(e,t,[]):new Account(e,t);return r._data.name=r._data.name?LPProxy.decryptMobile(r._data.name,!1,r.getKey()):"",r};SharedFolderAccessDialog.prototype.getAvailableItems=function(){return this.unrestrictedItems},SharedFolderAccessDialog.prototype.getSelectedItems=function(){return this.restrictedItems};var t=function(e){for(var t=[],r=0,i=e.length;r<i;++r)t.push(e[r].getID());return t.join(",")};SharedFolderAccessDialog.prototype.getData=function(e){var r=ContainerSelectionDialog.prototype.getData.apply(this,arguments);return r.aids="",this.containers.selected&&(r.aids=t(this.containers.selected.getItemModelChildren())),r.additionaluids="",r.applyToOthers&&this.containers.otherMembers&&(r.additionaluids=t(this.containers.otherMembers.getSelectedModelItems())),r},SharedFolderAccessDialog.prototype.handleSubmit=function(e){LPRequest.makeRequest(LPProxy.updateSharedFolderRestrictions,{params:$.extend(e,{uid:this.member.getID(!0),shareid:this.member._sharedGroup.getID()})})}}();
//# sourceMappingURL=sourcemaps/sharedFolderAccessDialog.js.map
