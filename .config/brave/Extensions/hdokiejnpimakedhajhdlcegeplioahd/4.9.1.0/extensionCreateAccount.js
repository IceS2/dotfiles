var ExtensionCreateAccount=function(e,t){t||(t={}),Dialog.call(this,e,Object.assign(t,{dynamicHeight:!1,responsive:!1,buttonAlign:this.RIGHT_ALIGN,largeButtons:!0,buttonsInsideContent:!0,title:Strings.translateString("Create Account"),hideHeaderTitle:!0,hideBackButton:!0,version:""})),this.isSubmitting=!1};ExtensionCreateAccount.prototype=Object.create(CreateAccountDialog.prototype),ExtensionCreateAccount.prototype.constructor=ExtensionCreateAccount,function(){var e,t;function r(e,t){bg.LPServer.textRequest({type:"GET",url:"create_account.php",CSRFToken:!1,data:{username:e,check:"avail",mistype:1},success:t,error:t})}function i(t,r){return function(i,a){var n=!1;return r&&(e.clearError(t),n=r.validate(i,function(r){e.addError(t,r)},a)),n}}ExtensionCreateAccount.prototype.initialize=function(t){CreateAccountDialog.prototype.initialize.apply(this,arguments),$(".meterContainer").remove(),this.inputFields.password.getElement().LP_addPasswordMeter(this.inputFields.email.getElement(),!this.data.isPopup),e=this;var a=t.find(".buttonContent"),n=t.find(".buttons").detach();a.append(n),function(){if(!e.inputFields.email.fieldValidator){var t=LPTools.createElement("a",{class:"pull-right recovery-link",href:"https://lastpass.com/forgot.php",target:"_blank"},Strings.translateString("Recovery Help")),r=LPTools.createElement("p",null,Strings.translateString("Email address already in use "));r.appendChild(t);var a=new FieldValidator({summary:{id:"validatorSummaryEmail",parentEl:$("label[for='createAccountEmail'].error-summary"),labelEl:$("label[for='createAccountEmail'].validator-label")},validators:[{id:"403",errorMsg:LPTools.createElement("p",null,Strings.translateString("You've made too many attempts, wait 5 minutes and try again.")),isValid:function(e){return!(e.response.status&&403===e.response.status)}},{id:"emailUsed",errorMsg:r,isValid:function(e){return"no"!==e.response}},{id:"emailInvalid",errorMsg:LPTools.createElement("p",null,Strings.translateString("Make sure to use a real email address")),isValid:function(e){return"ok"===e.response&&0!==e.response.indexOf("mistype:")&&"emailinvalid"!==e.response}}]});e.inputFields.email.validate=i("email",a),e.inputFields.email.fieldValidator=a}}(),function(){if(!e.inputFields.termsAndConditions.fieldValidator){var t=new FieldValidator({summary:{id:"validatorSummaryTermsAndConditions",parentEl:$("label[for='termsAndConditions'].error-summary"),labelEl:$("label[for='createAccountEmail'].validator-label")},validators:[{id:"termsNotChecked",errorMsg:LPTools.createElement("p",null,Strings.translateString("Please agree to the Terms and Conditions")),isValid:function(e){return!0===e.termsAndConditions}}]});e.inputFields.termsAndConditions.validate=i("termsAndConditions",t),e.inputFields.termsAndConditions.fieldValidator=t}}(),e.inputFields.email.getElement().unbind("change"),e.inputFields.email.onChange(function(t){t&&r(t,function(r){var i;e.inputFields.email.validate({response:r}),(i=t)&&$("#masterPasswordDialogTitle").text(i).attr("title",i)})}),e.inputFields.password.onChange(function(t){t&&e.inputFields.password.validate({password:e.inputFields.password.getValue(),email:e.inputFields.email.getValue()})}),e.inputFields.password.getElement().keyup(function(t){e.inputFields.password.validate({password:e.inputFields.password.getValue(),email:e.inputFields.email.getValue()},!0)}),e.inputFields.reconfirm.onChange(function(t){t&&e.inputFields.reconfirm.validate({reconfirm:e.inputFields.reconfirm.getValue(),password:e.inputFields.password.getValue()})}),e.inputFields.reminder.onChange(function(t){t&&e.inputFields.reminder.validate({reminder:e.inputFields.reminder.getValue(),password:e.inputFields.password.getValue()})}),e.setDynamicHeight()},ExtensionCreateAccount.prototype.setNextView=function(t){Dialog.prototype.setNextView.apply(this,arguments),bg.sendLpImprove("viewregform",{currentPage:0===this.currentViewIndex?"email":"mpw",version:e.data.version})},ExtensionCreateAccount.prototype.close=function(e){e?Dialog.prototype.close.apply(this,arguments):function(e){LPTools.getOption(e.data,"showcloseconfirm",!0)?(this._backgroundOverlay.show(),dialogs.confirmation.open({title:"LastPass",text:Strings.translateString("Do you really want to quit?  You cannot use LastPass without creating an account."),closeHandler:function(){t.hide()},handler:function(){e.close(!0)}})):e.close(!0)}(this)},ExtensionCreateAccount.prototype.clearError=function(e){var t=this.inputFields[e];t&&t.clearErrors()},ExtensionCreateAccount.prototype.addError=function(e,t){var r=this.inputFields[e];r&&(r._errors.push(t),r.clearErrors=function(){this._errors=[],r._errorElement&&r._errorElement.remove(),this._errorElement=null})},ExtensionCreateAccount.prototype.validate=function(t,i){if(0===this.currentViewIndex)r(t.email,function(r){var a=e.inputFields.email.validate({response:r});a&&(a&=e.inputFields.termsAndConditions.validate(t)),i&&i(a)});else if(this.currentViewIndex===this.views.length-1){var a=e.inputFields.password.validate(t);a&=e.inputFields.reconfirm.validate(t),a&=e.inputFields.reminder.validate(t),i&&i(a)}},ExtensionCreateAccount.prototype.submit=function(){try{if(e.isSubmitting)return;e.isSubmitting=!0;var t=this.getData();this.validate(t,function(r){if(r){var a={currentPage:"mpw",version:e.data.version};bg.sendLpImprove("viewregform",a),e.getNextViewButton()===e.nextButton&&e.views&&e.currentViewIndex<e.views.length-1?(!function(){if(!e.inputFields.password.fieldValidator){var t=new FieldValidator({summary:{id:"validatorSummaryPassword",parentEl:$("label[for='createAccountDialogPassword'].error-summary"),labelEl:$("label[for='createAccountDialogPassword'].validator-label"),errorMsg:LPTools.createElement("p",null,Strings.translateString("Sorry, your password is invalid"))},listParentEl:$("#mpValidators"),isPopup:e.data.isPopup,validators:[{id:"passwordLength",name:LPTools.createElement("p",null,Strings.translateString("At least 8 characters long")),errorMsg:LPTools.createElement("p",null,Strings.translateString("Master password must be at least 8 characters")),isValid:function(e){return!0===(e.password&&e.password.length>=8)}},{id:"passwordSameAsEmail",name:LPTools.createElement("p",null,Strings.translateString("Not your email")),errorMsg:LPTools.createElement("p",null,Strings.translateString("Master password shouldn‘t contain your email")),isValid:function(e){return!0===(e.password&&e.email&&-1===e.password.toLowerCase().indexOf(e.email.toLowerCase())&&-1===e.email.toLowerCase().indexOf(e.password.toLowerCase()))}},{id:"easyPassword",name:LPTools.createElement("p",null,Strings.translateString("Not easily guessable")),errorMsg:LPTools.createElement("p",null,Strings.translateString("That‘s in the top 100 most-used passwords")),isValid:function(e){return!0===(e.password&&!e.password.match(/^password\d{0,3}$/i)&&!e.password.match(/^lastpass\d{0,3}$/i)&&!e.password.match(/^.{0,7}$/)&&"12345678"!==e.password&&"123456789"!==e.password&&"1234567890"!==e.password&&"lastpass.com"!==e.password&&"qwertyuiop"!==e.password&&"abcd1234"!==e.password)}}]});e.inputFields.password.validate=i("password",t),e.inputFields.password.fieldValidator=t}}(),function(){if(!e.inputFields.reconfirm.fieldValidator){$("#twinsies").hide();var t=new FieldValidator({summary:{id:"validatorSummaryReconfirm",parentEl:$("label[for='createAccountDialogConfirmPassword'].error-summary"),labelEl:$("label[for='createAccountDialogConfirmPassword'].validator-label, #twinsies")},validators:[{id:"reconfirmSameAsPassword",name:LPTools.createElement("p",null,Strings.translateString("Reconfirm same as password")),errorMsg:LPTools.createElement("p",null,Strings.translateString("Make sure this matches your master password")),isValid:function(e){return!0===(e.reconfirm&&e.password===e.reconfirm)}}]});e.inputFields.reconfirm.validate=i("reconfirm",t),e.inputFields.reconfirm.fieldValidator=t}}(),function(){if(!e.inputFields.reminder.fieldValidator){var t=new FieldValidator({summary:{id:"validatorSummaryReminder",parentEl:$("label[for='createAccountReminder'].error-summary"),labelEl:$("label[for='createAccountReminder'].validator-label")},validators:[{id:"reminderNotPassword",name:LPTools.createElement("p",null,Strings.translateString("Reminder doesn‘t contain password")),errorMsg:LPTools.createElement("p",null,Strings.translateString("Reminder can‘t contain your master password")),isValid:function(e){return!(e.password&&-1!==e.reminder.toLowerCase().indexOf(e.password.toLowerCase()))}}]});e.inputFields.reminder.validate=i("reminder",t),e.inputFields.reminder.fieldValidator=t}}(),e.setNextView(e.currentViewIndex+1),e.setDynamicHeight()):(bg.sendLpImprove("completedregform",{version:e.data.version}),e.handleSubmit(t,this.data))}else{var n=function(){var t=[];for(var r in e.inputFields)e.inputFields.hasOwnProperty(r)&&e.inputFields[r].fieldValidator&&(t=t.concat(e.inputFields[r].fieldValidator.getValidationList()));return t}().join(",");a={errorlist:n,version:e.data.version};e.inputFields.reminder&&""!==e.inputFields.reminder.getValue()&&(a.isReminder=!0),n.length>0&&(a.currentPage=0===e.currentViewIndex?"email":"mpw",bg.sendLpImprove("validationregform",a))}e.isSubmitting=!1})}catch(t){e.isSubmitting=!1,LPPlatform.logException(t)}},ExtensionCreateAccount.prototype.showInProcessOverlay=function(){t.show(!0)},ExtensionCreateAccount.prototype.setBackgroundOverlay=function(e){t=e}}();
//# sourceMappingURL=sourcemaps/extensionCreateAccount.js.map
